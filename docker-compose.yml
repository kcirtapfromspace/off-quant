services:
  ollama:
    image: ollama/ollama:latest
    ports:
      - "11434:11434"
    environment:
      OLLAMA_HOST: "0.0.0.0"
    volumes:
      - /Volumes/models/ollama:/root/.ollama
      - /Volumes/models:/models:ro
      - .:/repo:ro
    restart: unless-stopped

  aider:
    build:
      context: .
      dockerfile: Dockerfile.aider
    image: off-quant/aider:local
    profiles: ["manual"]
    working_dir: /repo
    env_file:
      - .env.local
    environment:
      OLLAMA_API_BASE: "http://ollama:11434"
    volumes:
      - .:/repo
      - /Volumes/models:/models:ro
    stdin_open: true
    tty: true
